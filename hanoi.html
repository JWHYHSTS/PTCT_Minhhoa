<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th√°p H√† N·ªôi ‚Äì Tower of Hanoi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* ====== GLOBAL ====== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #1c2541, #3a506b, #0b132b);
      color: #0b132b;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: rgba(255, 255, 255, 0.97);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
      padding: 20px 20px 24px;
      backdrop-filter: blur(10px);
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 24px 28px 28px;
      }
    }

    /* ====== HEADER ====== */
    .header {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }

    .title-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: baseline;
      justify-content: space-between;
    }

    .title-row h1 {
      font-size: 1.4rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-weight: 700;
      color: #172a3a;
    }

    .title-tagline {
      font-size: 0.85rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #7589a2;
    }

    .subtitle {
      font-size: 0.95rem;
      color: #4f5d75;
      max-width: 640px;
      line-height: 1.4;
    }

    /* ====== LAYOUT ====== */
    .layout {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    @media (min-width: 900px) {
      .layout {
        display: grid;
        grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
        gap: 22px;
        align-items: flex-start;
      }
    }

    /* ====== GAME CARD ====== */
    .game-card {
      background: #edf2f4;
      border-radius: 16px;
      padding: 16px 14px 18px;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.03);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (min-width: 768px) {
      .game-card {
        padding: 16px 18px 20px;
      }
    }

    .game-top-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
    }

    .controls-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .controls-group label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #344966;
    }

    .controls-group select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #fff;
      font-size: 0.85rem;
      outline: none;
      min-width: 70px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
    }

    .btn {
      position: relative;
      border: none;
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.15s ease, color 0.15s ease;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
      white-space: nowrap;
    }

    .btn:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1b5f8c, #1088a3);
      color: #f9fafb;
    }

    .btn-secondary {
      background: #f8fafc;
      color: #1e293b;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.14);
    }

    .btn-tertiary {
      background: #e2e8f0;
      color: #0f172a;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.12);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(15, 23, 42, 0.26);
    }

    .btn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.2);
    }

    .btn-pill-icon {
      font-size: 1rem;
    }

    /* ====== STATUS BAR ====== */
    .status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 1px 0 rgba(148, 163, 184, 0.4);
    }

    .status-left,
    .status-right {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .badge {
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      background: #e0f2fe;
      color: #075985;
    }

    .badge span.value {
      font-weight: 700;
      font-feature-settings: "tnum" 1, "lnum" 1;
    }

    .badge-muted {
      background: #f1f5f9;
      color: #334155;
    }

    .status-message {
      font-size: 0.8rem;
      color: #475569;
      max-width: 320px;
    }

    /* ====== TOWERS AREA ====== */
    .towers-wrapper {
      margin-top: 12px;
      padding: 10px 8px 12px;
      border-radius: 14px;
      background: linear-gradient(145deg, #dbeafe, #e2e8f0);
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.3);
    }

    .towers-label-row {
      display: flex;
      justify-content: space-between;
      padding: 0 12px 4px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #64748b;
      font-weight: 600;
    }

    .towers {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 10px;
      min-height: 220px;
    }

    @media (min-width: 768px) {
      .towers {
        min-height: 260px;
      }
    }

    .peg {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      padding: 0 4px 26px;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      border-radius: 10px;
    }

    .peg::before {
      /* rod */
      content: "";
      position: absolute;
      bottom: 26px;
      width: 6px;
      height: 70%;
      max-height: 190px;
      border-radius: 999px;
      background: linear-gradient(to bottom, #94a3b8, #64748b);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.16);
    }

    .peg::after {
      /* base */
      content: "";
      position: absolute;
      bottom: 14px;
      width: 88%;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(to right, #0f172a, #111827);
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.6);
    }

    .peg:hover {
      background: rgba(148, 163, 184, 0.18);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
      transform: translateY(-2px);
    }

    .peg.selected {
      background: rgba(56, 189, 248, 0.22);
      box-shadow: 0 10px 22px rgba(56, 189, 248, 0.5);
    }

    .peg.hint {
      box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.8), 0 10px 20px rgba(251, 191, 36, 0.4);
    }

    .peg-name {
      position: absolute;
      bottom: 2px;
      font-size: 0.85rem;
      font-weight: 700;
      color: #0f172a;
    }

    .discs {
      position: relative;
      width: 100%;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      gap: 3px;
      z-index: 2;
    }

    .disc {
      height: 20px;
      border-radius: 999px;
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: #0f172a;
      border: 1px solid rgba(15, 23, 42, 0.12);
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }

    .disc::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 10%, rgba(255, 255, 255, 0.35), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .disc.moving {
      transform: translateY(-12px);
      box-shadow: 0 12px 25px rgba(15, 23, 42, 0.4);
    }

    .disc-label {
      position: relative;
      z-index: 1;
    }

    /* ====== KNOWLEDGE PANEL ====== */
    .knowledge-card {
      background: #0b132b;
      color: #e5e7eb;
      border-radius: 16px;
      padding: 14px 14px 16px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.7);
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .knowledge-card {
        padding: 16px 18px 18px;
      }
    }

    .knowledge-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(96, 165, 250, 0.16), transparent 55%),
        radial-gradient(circle at 120% 10%, rgba(56, 189, 248, 0.22), transparent 50%),
        radial-gradient(circle at 50% 120%, rgba(52, 211, 153, 0.18), transparent 55%);
      opacity: 1;
      pointer-events: none;
      z-index: 0;
    }

    .knowledge-inner {
      position: relative;
      z-index: 1;
    }

    .knowledge-title {
      font-size: 1.02rem;
      font-weight: 650;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .knowledge-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.7rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .knowledge-subtitle {
      font-size: 0.82rem;
      color: #cbd5f5;
      margin-bottom: 8px;
    }

    .knowledge-section {
      border-radius: 10px;
      padding: 8px 9px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.35);
      margin-bottom: 7px;
    }

    .knowledge-section h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #bfdbfe;
      margin-bottom: 4px;
    }

    .knowledge-section p,
    .knowledge-section li {
      font-size: 0.8rem;
      line-height: 1.4;
      color: #e5e7eb;
    }

    .knowledge-section ul {
      margin-left: 16px;
      margin-top: 2px;
      list-style: disc;
    }

    .formula {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(15, 23, 42, 0.85);
      padding: 4px 7px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      margin-top: 4px;
      border: 1px solid rgba(129, 140, 248, 0.7);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.85);
    }

    .formula span {
      color: #e5e7eb;
    }

    .formula .highlight {
      color: #fde68a;
    }

    /* ====== WIN OVERLAY ====== */
    .overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.55), rgba(15, 23, 42, 0.88));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .overlay-card {
      max-width: 420px;
      width: 100%;
      background: radial-gradient(circle at top, #1f2937, #020617);
      border-radius: 18px;
      padding: 20px 18px 18px;
      box-shadow:
        0 22px 45px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.5);
      text-align: center;
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
    }

    .overlay-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(251, 191, 36, 0.15), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(56, 189, 248, 0.18), transparent 55%);
      opacity: 1;
      pointer-events: none;
    }

    .overlay-inner {
      position: relative;
      z-index: 1;
    }

    .overlay-icon {
      font-size: 2.3rem;
      margin-bottom: 6px;
      animation: pop 0.55s ease-out;
    }

    @keyframes pop {
      0% {
        transform: scale(0.4);
        opacity: 0;
      }
      60% {
        transform: scale(1.15);
        opacity: 1;
      }
      100% {
        transform: scale(1);
      }
    }

    .overlay-title {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .overlay-text {
      font-size: 0.9rem;
      color: #e5e7eb;
      margin-bottom: 10px;
    }

    .overlay-metrics {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .overlay-metric {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .overlay-metric span.value {
      font-weight: 700;
      color: #e5e7eb;
    }

    .overlay-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .overlay-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 14px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.15s ease, color 0.15s ease;
    }

    .overlay-btn-primary {
      background: linear-gradient(135deg, #22c55e, #84cc16);
      color: #022c22;
      box-shadow: 0 10px 20px rgba(34, 197, 94, 0.45);
    }

    .overlay-btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    .overlay-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.8);
    }

    .overlay-btn:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.75);
    }

    /* ====== UTILS ====== */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <main class="app-shell">
    <header class="header">
      <div class="title-row">
        <h1>Th√°p H√† N·ªôi ‚Äì Tower of Hanoi</h1>
        <span class="title-tagline">ƒê·ªá quy tr·ª±c quan ‚Ä¢ Tin h·ªçc 11</span>
      </div>
      <p class="subtitle">
        Lu·∫≠t ch∆°i: Di chuy·ªÉn to√†n b·ªô ch·ªìng ƒëƒ©a t·ª´ c·ªçc <strong>A</strong> sang c·ªçc
        <strong>C</strong>, m·ªói l·∫ßn ch·ªâ ƒë∆∞·ª£c di chuy·ªÉn <strong>1 ƒëƒ©a</strong> v√†
        <strong>kh√¥ng ƒë∆∞·ª£c ƒë·∫∑t ƒëƒ©a l·ªõn l√™n tr√™n ƒëƒ©a nh·ªè</strong>.
      </p>
    </header>

    <section class="layout" aria-label="M√¥ ph·ªèng tr√≤ ch∆°i Th√°p H√† N·ªôi v√† ki·∫øn th·ª©c ƒë·ªá quy">
      <!-- GAME AREA -->
      <section class="game-card" aria-label="Khu v·ª±c tr√≤ ch∆°i Th√°p H√† N·ªôi">
        <div class="game-top-row">
          <div class="controls-group">
            <label for="diskCountSelect">S·ªë ƒëƒ©a:</label>
            <select id="diskCountSelect">
              <option value="3">3 ƒëƒ©a (d·ªÖ)</option>
              <option value="4">4 ƒëƒ©a</option>
              <option value="5" selected>5 ƒëƒ©a</option>
              <option value="6">6 ƒëƒ©a</option>
              <option value="7">7 ƒëƒ©a (kh√≥)</option>
            </select>
          </div>

          <div class="btn-row">
            <button id="newGameBtn" class="btn btn-secondary" type="button">
              <span class="btn-pill-icon">üîÅ</span>
              Ch∆°i m·ªõi
            </button>
            <button id="autoSolveBtn" class="btn btn-primary" type="button">
              <span class="btn-pill-icon">ü§ñ</span>
              T·ª± ƒë·ªông gi·∫£i
            </button>
            <button id="hintBtn" class="btn btn-tertiary" type="button">
              <span class="btn-pill-icon">üí°</span>
              G·ª£i √Ω
            </button>
          </div>
        </div>

        <div class="status-bar" aria-live="polite">
          <div class="status-left">
            <div class="badge">
              L∆∞·ª£t ƒëi:
              <span id="moveCount" class="value">0</span>
            </div>
            <div class="badge badge-muted">
              T·ªëi thi·ªÉu:
              <span id="minMoves" class="value">0</span>
              b∆∞·ªõc
            </div>
          </div>
          <div class="status-right">
            <p id="statusMessage" class="status-message">
              Nh·∫•p ch·ªçn m·ªôt c·ªçc ngu·ªìn, sau ƒë√≥ nh·∫•p c·ªçc ƒë√≠ch ƒë·ªÉ di chuy·ªÉn ƒëƒ©a.
            </p>
          </div>
        </div>

        <div class="towers-wrapper">
          <div class="towers-label-row" aria-hidden="true">
            <span>C·ªçc A</span>
            <span>C·ªçc B</span>
            <span>C·ªçc C</span>
          </div>
          <div class="towers" role="group" aria-label="C√°c c·ªçc Th√°p H√† N·ªôi">
            <div class="peg" id="peg-A" data-peg="A" tabindex="0" aria-label="C·ªçc A">
              <div class="discs" id="discs-A"></div>
              <span class="peg-name">A</span>
            </div>
            <div class="peg" id="peg-B" data-peg="B" tabindex="0" aria-label="C·ªçc B">
              <div class="discs" id="discs-B"></div>
              <span class="peg-name">B</span>
            </div>
            <div class="peg" id="peg-C" data-peg="C" tabindex="0" aria-label="C·ªçc C">
              <div class="discs" id="discs-C"></div>
              <span class="peg-name">C</span>
            </div>
          </div>
        </div>
      </section>

      <!-- KNOWLEDGE AREA -->
      <aside class="knowledge-card" aria-label="B·∫£ng ki·∫øn th·ª©c ƒë·ªá quy cho Th√°p H√† N·ªôi">
        <div class="knowledge-inner">
          <div class="knowledge-title">
            G√ìC KI·∫æN TH·ª®C ƒê·ªÜ QUY
            <span class="knowledge-pill">RECURSION NOTES</span>
          </div>
          <p class="knowledge-subtitle">
            Li√™n h·ªá tr·ª±c ti·∫øp gi·ªØa tr√≤ ch∆°i v√† h√†m ƒë·ªá quy gi·∫£i Th√°p H√† N·ªôi.
          </p>

          <div class="knowledge-section">
            <h3>1. Base case (Tr∆∞·ªùng h·ª£p c∆° s·ªü)</h3>
            <p>
              Khi ch·ªâ c√≤n <strong>1 ƒëƒ©a</strong>, b√†i to√°n r·∫•t ƒë∆°n gi·∫£n:
              <strong>ch·ªâ c·∫ßn di chuy·ªÉn 1 ƒëƒ©a t·ª´ c·ªçc ngu·ªìn sang c·ªçc ƒë√≠ch</strong>.
            </p>
            <p>
              Trong code: <em>n == 1 &rarr; th·ª±c hi·ªán 1 b∆∞·ªõc di chuy·ªÉn r·ªìi d·ª´ng l·∫°i</em>.
            </p>
          </div>

          <div class="knowledge-section">
            <h3>2. Recursive case (Tr∆∞·ªùng h·ª£p ƒë·ªá quy)</h3>
            <p>Khi <strong>n &gt; 1</strong>, ta t√°ch b√†i to√°n th√†nh 3 b∆∞·ªõc:</p>
            <ul>
              <li>1Ô∏è‚É£ Di chuy·ªÉn <strong>n - 1</strong> ƒëƒ©a tr√™n c√πng t·ª´ <strong>c·ªçc ngu·ªìn</strong> sang <strong>c·ªçc trung gian</strong>.</li>
              <li>2Ô∏è‚É£ Di chuy·ªÉn <strong>ƒëƒ©a l·ªõn nh·∫•t</strong> c√≤n l·∫°i t·ª´ <strong>c·ªçc ngu·ªìn</strong> sang <strong>c·ªçc ƒë√≠ch</strong>.</li>
              <li>3Ô∏è‚É£ Di chuy·ªÉn <strong>n - 1</strong> ƒëƒ©a t·ª´ <strong>c·ªçc trung gian</strong> sang <strong>c·ªçc ƒë√≠ch</strong>.</li>
            </ul>
          </div>

          <div class="knowledge-section">
            <h3>3. Chi·∫øn l∆∞·ª£c 3 b∆∞·ªõc (thu·∫≠t to√°n)</h3>
            <p>H√†m ƒë·ªá quy t·ªïng qu√°t c√≥ d·∫°ng:</p>
            <ul>
              <li>Hanoi(n, from, to, aux)</li>
              <li>N·∫øu n == 1: di chuy·ªÉn 1 ƒëƒ©a t·ª´ from ‚Üí to.</li>
              <li>N·∫øu n &gt; 1: g·ªçi l·∫°i ch√≠nh n√≥ 3 l·∫ßn theo 3 b∆∞·ªõc ·ªü tr√™n.</li>
            </ul>
          </div>

          <div class="knowledge-section">
            <h3>4. S·ªë b∆∞·ªõc t·ªëi thi·ªÉu</h3>
            <p>
              ƒê·ªÉ chuy·ªÉn <strong>n ƒëƒ©a</strong> m·ªôt c√°ch t·ªëi ∆∞u, c·∫ßn s·ªë b∆∞·ªõc:
            </p>
            <div class="formula">
              <span>T(n) =</span>
              <span class="highlight">2‚Åø ‚àí 1</span>
              <span>b∆∞·ªõc</span>
            </div>
            <p style="margin-top: 5px;">
              V√≠ d·ª•: 3 ƒëƒ©a ‚Üí <strong>7 b∆∞·ªõc</strong>, 4 ƒëƒ©a ‚Üí <strong>15 b∆∞·ªõc</strong>.
            </p>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <!-- WIN OVERLAY -->
  <div id="winOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="winTitle">
    <div class="overlay-card">
      <div class="overlay-inner">
        <div class="overlay-icon">üéâ</div>
        <h2 id="winTitle" class="overlay-title">Ho√†n th√†nh Th√°p H√† N·ªôi!</h2>
        <p id="winText" class="overlay-text">
          Ch√∫c m·ª´ng b·∫°n ƒë√£ chuy·ªÉn to√†n b·ªô ƒëƒ©a sang c·ªçc C theo ƒë√∫ng lu·∫≠t!
        </p>
        <div class="overlay-metrics">
          <div class="overlay-metric">
            <span>üéØ L∆∞·ª£t ƒëi:</span>
            <span id="winMoves" class="value">0</span>
          </div>
          <div class="overlay-metric">
            <span>üìê T·ªëi thi·ªÉu:</span>
            <span id="winMinMoves" class="value">0</span>
          </div>
        </div>
        <div class="overlay-actions">
          <button id="winPlayAgainBtn" class="overlay-btn overlay-btn-primary" type="button">
            <span>Ch∆°i l·∫°i</span> üîÅ
          </button>
          <button id="winCloseBtn" class="overlay-btn overlay-btn-secondary" type="button">
            <span>ƒê√≥ng</span> ‚úñ
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================
    // TR·∫†NG TH√ÅI TO√ÄN C·ª§C
    // ==========================
    let towers = {
      A: [],
      B: [],
      C: [],
    };

    let totalDisks = 5;
    let moveCount = 0;
    let minMoves = 0;

    let selectedPeg = null;
    let isAutoSolving = false;
    let autoMoves = [];
    let autoIndex = 0;
    let autoTimer = null;

    // ==========================
    // TRUY C·∫¨P DOM
    // ==========================
    const diskSelect = document.getElementById("diskCountSelect");
    const newGameBtn = document.getElementById("newGameBtn");
    const autoSolveBtn = document.getElementById("autoSolveBtn");
    const hintBtn = document.getElementById("hintBtn");

    const moveCountSpan = document.getElementById("moveCount");
    const minMovesSpan = document.getElementById("minMoves");
    const statusMessage = document.getElementById("statusMessage");

    const pegElements = {
      A: document.getElementById("peg-A"),
      B: document.getElementById("peg-B"),
      C: document.getElementById("peg-C"),
    };

    const discsContainers = {
      A: document.getElementById("discs-A"),
      B: document.getElementById("discs-B"),
      C: document.getElementById("discs-C"),
    };

    const winOverlay = document.getElementById("winOverlay");
    const winMovesSpan = document.getElementById("winMoves");
    const winMinMovesSpan = document.getElementById("winMinMoves");
    const winPlayAgainBtn = document.getElementById("winPlayAgainBtn");
    const winCloseBtn = document.getElementById("winCloseBtn");

    // M√†u cho ƒëƒ©a (v√≤ng t·ª´ ƒë·∫ßu m·∫£ng n·∫øu c·∫ßn)
    const discColors = [
      "#38bdf8",
      "#a855f7",
      "#fb923c",
      "#22c55e",
      "#eab308",
      "#f97373",
      "#4ade80",
    ];

    // ==========================
    // H√ÄM GHI ƒê·ªÜ QUY SINH DANH S√ÅCH B∆Ø·ªöC ƒêI
    // (recursive generate ‚Äì d√πng ƒë·ªÉ auto-solve & g·ª£i √Ω)
    // ==========================
    function generateRecursiveMoves(n, from, to, aux, moves) {
      // Base case: ch·ªâ c√≤n 1 ƒëƒ©a ‚Üí di chuy·ªÉn tr·ª±c ti·∫øp
      if (n === 1) {
        moves.push({ from, to });
        return;
      }

      // Recursive case: t√°ch th√†nh 3 b∆∞·ªõc kinh ƒëi·ªÉn
      generateRecursiveMoves(n - 1, from, aux, to, moves); // B∆∞·ªõc 1
      moves.push({ from, to }); // B∆∞·ªõc 2
      generateRecursiveMoves(n - 1, aux, to, from, moves); // B∆∞·ªõc 3
    }

    // D√πng h√†m ƒë·ªá quy ƒë·ªÉ sinh to√†n b·ªô l·ªùi gi·∫£i t·ªëi ∆∞u t·ª´ tr·∫°ng th√°i ban ƒë·∫ßu
    function buildSolution() {
      autoMoves = [];
      generateRecursiveMoves(totalDisks, "A", "C", "B", autoMoves);
      minMoves = Math.pow(2, totalDisks) - 1;
      minMovesSpan.textContent = minMoves;
    }

    // ==========================
    // KH·ªûI T·∫†O / RESET TR√í CH∆†I
    // ==========================
    function initGame() {
      stopAutoSolve(true);

      totalDisks = parseInt(diskSelect.value, 10);
      towers = { A: [], B: [], C: [] };

      // ƒê·∫∑t n ƒëƒ©a l√™n c·ªçc A (ƒëƒ©a l·ªõn ·ªü d∆∞·ªõi)
      for (let i = totalDisks; i >= 1; i--) {
        towers.A.push(i);
      }

      moveCount = 0;
      updateMoveCount();
      buildSolution();
      renderTowers();
      clearSelection();
      setStatus(
        "Nh·∫•p c·ªçc A, B ho·∫∑c C ƒë·ªÉ ch·ªçn c·ªçc ngu·ªìn, sau ƒë√≥ nh·∫•p c·ªçc ƒë√≠ch ƒë·ªÉ di chuy·ªÉn ƒëƒ©a."
      );
      hideWinOverlay();
    }

    function updateMoveCount() {
      moveCountSpan.textContent = moveCount;
    }

    function setStatus(msg) {
      statusMessage.textContent = msg;
    }

    // ==========================
    // V·∫º L·∫†I C√ÅC C·ªåC & ƒêƒ®A TR√äN DOM
    // ==========================
    function renderTowers() {
      ["A", "B", "C"].forEach((pegId) => {
        const container = discsContainers[pegId];
        container.innerHTML = "";

        const pegDisks = towers[pegId];

        pegDisks.forEach((discSize) => {
          const discEl = document.createElement("div");
          discEl.className = "disc";

          const widthPercent =
            38 + ((discSize - 1) / Math.max(1, totalDisks - 1)) * 48;
          discEl.style.width = widthPercent + "%";

          const color = discColors[(discSize - 1) % discColors.length];
          discEl.style.background = `linear-gradient(135deg, ${color}, #0f172a)`;

          const label = document.createElement("span");
          label.className = "disc-label";
          label.textContent = discSize;
          discEl.appendChild(label);

          container.appendChild(discEl);
        });
      });
    }

    // T·∫°o hi·ªáu ·ª©ng khi ƒëƒ©a di chuy·ªÉn
    function animateLastDisc(pegId) {
      const container = discsContainers[pegId];
      const lastDisc = container.lastElementChild;
      if (!lastDisc) return;
      lastDisc.classList.add("moving");
      setTimeout(() => {
        lastDisc.classList.remove("moving");
      }, 250);
    }

    // ==========================
    // X·ª¨ L√ù CH·ªåN C·ªåC & DI CHUY·ªÇN ƒêƒ®A
    // ==========================
    function handlePegClick(pegId) {
      if (isAutoSolving) return;

      if (!selectedPeg) {
        // Ch·ªçn c·ªçc ngu·ªìn
        if (towers[pegId].length === 0) {
          setStatus("C·ªçc n√†y kh√¥ng c√≥ ƒëƒ©a ƒë·ªÉ di chuy·ªÉn. H√£y ch·ªçn c·ªçc kh√°c.");
          return;
        }
        selectedPeg = pegId;
        updateSelectionHighlight();
        setStatus("Ch·ªçn c·ªçc ƒë√≠ch ƒë·ªÉ di chuy·ªÉn ƒëƒ©a.");
      } else {
        // ƒêang ch·ªçn c·ªçc ngu·ªìn ‚Üí ch·ªçn c·ªçc ƒë√≠ch
        if (selectedPeg === pegId) {
          // B·∫•m l·∫°i c√πng c·ªçc ‚Üí h·ªßy
          clearSelection();
          setStatus("ƒê√£ h·ªßy l·ª±a ch·ªçn c·ªçc ngu·ªìn.");
          return;
        }
        const moved = moveDisc(selectedPeg, pegId, false);
        clearSelection();
        if (moved) {
          setStatus(`ƒê√£ di chuy·ªÉn 1 ƒëƒ©a t·ª´ c·ªçc ${selectedPeg} sang c·ªçc ${pegId}.`);
        }
      }
    }

    function moveDisc(fromPeg, toPeg, isAuto) {
      const fromStack = towers[fromPeg];
      const toStack = towers[toPeg];

      if (fromStack.length === 0) {
        setStatus("C·ªçc ngu·ªìn kh√¥ng c√≥ ƒëƒ©a.");
        return false;
      }

      const disc = fromStack[fromStack.length - 1];
      const destTop = toStack[toStack.length - 1];

      // Ki·ªÉm tra vi ph·∫°m lu·∫≠t (ƒëƒ©a l·ªõn ƒë·∫∑t l√™n ƒëƒ©a nh·ªè)
      if (destTop !== undefined && destTop < disc) {
        setStatus("L·ªói: Kh√¥ng ƒë∆∞·ª£c ƒë·∫∑t ƒëƒ©a l·ªõn l√™n tr√™n ƒëƒ©a nh·ªè.");
        return false;
      }

      fromStack.pop();
      toStack.push(disc);

      if (!isAuto) {
        moveCount++;
        updateMoveCount();
      }

      renderTowers();
      animateLastDisc(toPeg);
      if (!isAuto) {
    checkWinCondition();
  }
      return true;
    }

    function clearSelection() {
      selectedPeg = null;
      updateSelectionHighlight();
    }

    function updateSelectionHighlight() {
      ["A", "B", "C"].forEach((pegId) => {
        pegElements[pegId].classList.toggle(
          "selected",
          selectedPeg === pegId
        );
      });
    }

    // ==========================
    // KI·ªÇM TRA TH·∫ÆNG
    // ==========================
    function checkWinCondition() {
      if (towers.C.length === totalDisks) {
        showWinOverlay();
      }
    }

    function showWinOverlay() {
      winMovesSpan.textContent = moveCount;
      winMinMovesSpan.textContent = minMoves;
      winOverlay.classList.add("visible");
    }

    function hideWinOverlay() {
      winOverlay.classList.remove("visible");
    }

    // ==========================
    // AUTO-SOLVE (D√ôNG DANH S√ÅCH B∆Ø·ªöC ƒê·ªÜ QUY)
    // ==========================
    function startAutoSolve() {
  if (isAutoSolving) return;

  const isInitial =
    towers.A.length === totalDisks &&
    towers.B.length === 0 &&
    towers.C.length === 0 &&
    moveCount === 0;

  if (!isInitial) {
    setStatus(
      "T·ª± ƒë·ªông gi·∫£i ch·ªâ ho·∫°t ƒë·ªông t·ª´ tr·∫°ng th√°i ban ƒë·∫ßu. H√£y b·∫•m 'Ch∆°i m·ªõi' tr∆∞·ªõc."
    );
    return;
  }

  isAutoSolving = true;
  autoIndex = 0;
  disableManualControls(true);
  setStatus("ƒêang t·ª± ƒë·ªông gi·∫£i... Vui l√≤ng ch·ªù.");

  // üîπ ƒë·ªïi n·ªôi dung n√∫t th√†nh ‚ÄúD·ª´ng t·ª± ƒë·ªông‚Äù
  autoSolveBtn.innerHTML =
    '<span class="btn-pill-icon">‚è∏</span>D·ª´ng t·ª± ƒë·ªông';

  const delay = 550;

  autoTimer = setInterval(() => {
    const { from, to } = autoMoves[autoIndex];
    moveDisc(from, to, true);
    moveCount++;
    updateMoveCount();
    autoIndex++;

    if (autoIndex >= autoMoves.length) {
      stopAutoSolve(false);
      setStatus("ƒê√£ ho√†n th√†nh l·ªùi gi·∫£i t·ª± ƒë·ªông.");
      showWinOverlay();
    }
  }, delay);
}

    function stopAutoSolve(silent) {
  if (autoTimer) {
    clearInterval(autoTimer);
    autoTimer = null;
  }
  if (isAutoSolving && !silent) {
    setStatus("ƒê√£ d·ª´ng t·ª± ƒë·ªông gi·∫£i.");
  }
  isAutoSolving = false;
  disableManualControls(false);

  // üîπ tr·∫£ n√∫t v·ªÅ ‚ÄúT·ª± ƒë·ªông gi·∫£i‚Äù
  autoSolveBtn.innerHTML =
    '<span class="btn-pill-icon">ü§ñ</span>T·ª± ƒë·ªông gi·∫£i';
}

    function disableManualControls(disable) {
      newGameBtn.disabled = disable;
      hintBtn.disabled = disable;
      diskSelect.disabled = disable;
      // Kh√≥a click tr√™n c√°c c·ªçc ƒë∆∞·ª£c x·ª≠ l√Ω trong handlePegClick (check bi·∫øn isAutoSolving)
    }

    // ==========================
    // G·ª¢I √ù B∆Ø·ªöC TI·∫æP THEO
    // (d√πng danh s√°ch b∆∞·ªõc t·ªëi ∆∞u t·ª´ tr·∫°ng th√°i ban ƒë·∫ßu)
    // ==========================
    function showHint() {
      if (isAutoSolving) return;

      const isInitialOrOptimalPath =
        towers.B.length === 0 &&
        towers.C.length === 0 &&
        towers.A.length === totalDisks &&
        moveCount === 0;

      if (!isInitialOrOptimalPath) {
        setStatus(
          "G·ª£i √Ω ch·ªâ ch√≠nh x√°c khi b·∫°n b·∫Øt ƒë·∫ßu t·ª´ tr·∫°ng th√°i ban ƒë·∫ßu. H√£y b·∫•m 'Ch∆°i m·ªõi' n·∫øu c·∫ßn."
        );
        return;
      }

      const nextMove = autoMoves[moveCount];
      if (!nextMove) {
        setStatus("B·∫°n ƒë√£ ho√†n th√†nh l·ªùi gi·∫£i t·ªëi ∆∞u r·ªìi!");
        return;
      }

      const { from, to } = nextMove;
      setStatus(
        `G·ª£i √Ω: H√£y di chuy·ªÉn 1 ƒëƒ©a t·ª´ c·ªçc ${from} sang c·ªçc ${to}.`
      );

      // Nh√°y s√°ng 2 c·ªçc ƒë∆∞·ª£c g·ª£i √Ω
      highlightHintPegs(from, to);
    }

    function highlightHintPegs(fromPeg, toPeg) {
      ["A", "B", "C"].forEach((pegId) => {
        pegElements[pegId].classList.remove("hint");
      });

      pegElements[fromPeg].classList.add("hint");
      pegElements[toPeg].classList.add("hint");

      setTimeout(() => {
        pegElements[fromPeg].classList.remove("hint");
        pegElements[toPeg].classList.remove("hint");
      }, 700);
    }

    // ==========================
    // G√ÅN S·ª∞ KI·ªÜN
    // ==========================
    function setupEventListeners() {
      ["A", "B", "C"].forEach((pegId) => {
        const pegEl = pegElements[pegId];

        pegEl.addEventListener("click", () => {
          handlePegClick(pegId);
        });

        pegEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            handlePegClick(pegId);
          }
        });
      });

      newGameBtn.addEventListener("click", () => {
        initGame();
      });

      autoSolveBtn.addEventListener("click", () => {
  if (isAutoSolving) {
    // üîπ n·∫øu ƒëang auto th√¨ b·∫•m l·∫ßn n·ªØa ‚Üí d·ª´ng
    stopAutoSolve(true);
    setStatus(
      "ƒê√£ d·ª´ng t·ª± ƒë·ªông gi·∫£i. B·∫°n c√≥ th·ªÉ ti·∫øp t·ª•c t·ª± di chuy·ªÉn ƒëƒ©a t·ª´ tr·∫°ng th√°i hi·ªán t·∫°i."
    );
  } else {
    // üîπ ch∆∞a ch·∫°y ‚Üí b·∫Øt ƒë·∫ßu auto
    startAutoSolve();
  }
});

      hintBtn.addEventListener("click", () => {
        showHint();
      });

      diskSelect.addEventListener("change", () => {
        initGame();
      });

      winPlayAgainBtn.addEventListener("click", () => {
        hideWinOverlay();
        initGame();
      });

      winCloseBtn.addEventListener("click", () => {
        hideWinOverlay();
      });

      winOverlay.addEventListener("click", (e) => {
        if (e.target === winOverlay) {
          hideWinOverlay();
        }
      });
    }

    // ==========================
    // KH·ªûI ƒê·ªòNG
    // ==========================
    setupEventListeners();
    initGame();
  </script>
</body>
</html>
